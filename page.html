<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript">

(function() { 
    if ("-ms-user-select" in document.documentElement.style && navigator.userAgent.match(/IEMobile\/10\.0/)) { 
        var msViewportStyle = document.createElement("style"); 
        msViewportStyle.appendChild( 
            document.createTextNode("@-ms-viewport{width:auto!important}") 
        ); 
        document.getElementsByTagName("head")[0].appendChild(msViewportStyle); 
    } 
})(); 

</script>

</head>
<body>
<div class="btn-group">
    <button class="btn btn-primary btn-lg" style="margin-left:5px" onclick="play()"><span class="glyphicon glyphicon-play"></span></button>
    <button class="btn btn-primary btn-lg" onclick="pause()"><span class="glyphicon glyphicon-pause"></span></button>
    <button class="btn btn-primary btn-lg" onclick="stop()"><span class="glyphicon glyphicon-stop"></span></button>
    <button class="btn btn-primary btn-lg" onclick="next()"><span class="glyphicon glyphicon-step-forward"></span></button>
    <button class="btn btn-primary btn-lg" onclick="dec_vol()"><span class="glyphicon glyphicon-volume-down"></span></button>
    <button class="btn btn-primary btn-lg" onclick="inc_vol()"><span class="glyphicon glyphicon-volume-up"></span></button>
</div>


<hr>
<br>

<div class="row">
    <div class="col-sm-1">
        <!--spacer-->
    </div>
    <div class="col-sm-2">
        <ul class="list-group" id="artists">
        </ul>
    </div>
    <div class="col-sm-4">
        <ul id="songs" class="list-group">
        </ul>
    </div>


</div>


<script>
var buttonStyle = "btn btn-sm btn-default"


var request = new XMLHttpRequest();
request.open("GET", document.URL + "artists");
request.onreadystatechange = function() { //Call a function when the state changes.
    if (request.readyState == 4 && request.status == 200) {
        data = JSON.parse(request.response)
        var artists = document.getElementById("artists");
        data.forEach(function(item) {
            var listItem = document.createElement("li");
            listItem.className = "list-group-item"
            var name = document.createTextNode(item);
            listItem.onclick = getSongs;
            listItem.appendChild(name);
            artists.appendChild(listItem);
        });
    }
}
request.send();



var selectedArtist = ''

function getSongs() {
    selectedArtist = this.innerHTML;
    var songRequest = new XMLHttpRequest();
    songRequest.open("GET", document.URL + "songs/" + this.innerHTML)
    songRequest.onreadystatechange = function() { //Call a function when the state changes.
        if (songRequest.readyState == 4 && songRequest.status == 200) {
            data = JSON.parse(songRequest.response);
            songList = document.getElementById("songs");

            songList.innerHTML = "";
            data.forEach(function(item) {
                // should create the following structure:
                //              li
                //      |           |
                // buttongroup     div
                //   |      |
                // play    plus

                var listItem = document.createElement("li");
                listItem.className = "list-group-item"

                var text = document.createElement("div");
                text.className = "song";
                text.innerText = item;
                text.style.display = "inline";

                var buttonGroup = document.createElement("div");
                buttonGroup.className = "btn-group";

                var playButton = document.createElement("btn");
                playButton.className = buttonStyle;
                var play = document.createElement("span");
                play.className = "glyphicon glyphicon-play";
                playButton.appendChild(play);
                playButton.onclick = playSong;

                var plusButton = document.createElement("btn");
                plusButton.className = buttonStyle;
                var plus = document.createElement("span");
                plus.className = "glyphicon glyphicon-plus";
                plusButton.appendChild(plus);
                plusButton.onclick = addSong;

                buttonGroup.appendChild(playButton);
                buttonGroup.appendChild(plusButton);

                listItem.appendChild(buttonGroup);
                listItem.appendChild(text);

                songList.appendChild(listItem);
            });

        }
    }
    songRequest.send();
};

function inc_vol(){
    var vol_inc_request = new XMLHttpRequest();
    vol_inc_request.open("PUT", document.URL + "volume/up");
    vol_inc_request.send()
}

function dec_vol(){
    var vol_dec_request = new XMLHttpRequest();
    vol_dec_request.open("PUT", document.URL + "volume/down");
    vol_dec_request.send()
}

function playSong() {
    // TODO fix ugly namegetting
    var song = this.parentNode.parentNode.getElementsByClassName("song")[0].innerText;
    var artist = selectedArtist;
    var playRequest = new XMLHttpRequest();
    playRequest.open("PUT", document.URL + "play/" + artist + "/" + song);
    playRequest.send();
}

function addSong(){
    // TODO fix ugly namegetting
    var song = this.parentNode.parentNode.getElementsByClassName("song")[0].innerText;
    var artist = selectedArtist;
    var addRequest = new XMLHttpRequest();
    addRequest.open("PUT", document.URL + "add" + "/" + artist + "/" + song)
    addRequest.send();
}

function play() {
    var playRequest = new XMLHttpRequest();
    playRequest.open("PUT", document.URL + "play");
    playRequest.onreadystatechange = responseAction(playRequest);
    playRequest.send();
    }

function pause() {
    var pauseRequest = new XMLHttpRequest();
    pauseRequest.open("PUT", document.URL + "pause");
    pauseRequest.send();
}

function stop() {
    var stopRequest = new XMLHttpRequest();
    stopRequest.open("PUT", document.URL + "stop");
    stopRequest.send();
}

function next(){
    var nextRequest = new XMLHttpRequest();
    nextRequest.open("PUT", document.URL + "next");
    nextRequest.send();
}

function responseAction(request){
    return function(event){
        if(request.readyState == 4){
            if(request.response == "1"){
                console.log("it worked");
            }
            else{
                console.log(request.response);
            }
        }
    };



}




</script>
</body>
</html>